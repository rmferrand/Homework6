[
  {
    "objectID": "WritingFunctions.html",
    "href": "WritingFunctions.html",
    "title": "WritingFunctions",
    "section": "",
    "text": "Purpose: This program seeks to complete the exercises listed in Homework 6, for ST558. Task 1 consists of conceptual based questions that will be similar to the upcoming Exam. Task 2 is concerned with function writing and the science behind wrapper functions. Task 3 builds on what we know from API’s and combines it with function creation to allow for specific api manipulation to find summary statistics."
  },
  {
    "objectID": "WritingFunctions.html#task-1-conceptual-questions",
    "href": "WritingFunctions.html#task-1-conceptual-questions",
    "title": "WritingFunctions",
    "section": "Task 1: Conceptual Questions",
    "text": "Task 1: Conceptual Questions\n\nWhat is the purpose of the lapply() function? What is the equivalent purrr function?\nlapply() applies a function to a list and obtains a list object as an output. It allows for cleaner and simpler syntax of repetitive operations. The equivalent purrr function is map().\nSuppose we have a list called my_list. Each element of the list is a numeric data frame (all columns are numeric). We want use lapply() to run the code cor(numeric_matrix, method = “kendall”) on each element of the list. Write code to do this below! (I’m really trying to ask you how you specify method = “kendall” when calling lapply())\nlapply(my_list, function(x) cor(x, method = \"kendall\"))\nWhat are two advantages of using purrr functions instead of the BaseR apply family?\n\nMore consistency and some helper functions that are not available in BaseR\npurrr allows the writing of functional code with less friction and greater ease, it decreases the gap between thinking of and implementing code (as per hadley)\n\nWhat is a side-effect function?\nSide-effect function is a function that does not try to transform or change the data (like a transformation function) it just tries to produce something, or change the state of something like the console, the plots, etc.\nWhy can you name a variable sd in a function and not cause any issues with the sd function?\nWhen you call a function, it creates temporary function environments. Due to the lexical scoping, the variables inside of functions (local scope) do not override the global scope, meaning sd() outside of the function will be unaffected."
  },
  {
    "objectID": "WritingFunctions.html#task-2-writing-r-functions",
    "href": "WritingFunctions.html#task-2-writing-r-functions",
    "title": "WritingFunctions",
    "section": "Task 2: Writing R Functions",
    "text": "Task 2: Writing R Functions\nLet’s load in the required libraries for this section:\n\nlibrary(tidyverse)\n\n\ngetRMSE()\nLet’s create a function called getRMSE() that takes in a vector of responses and a vector of predictions and outputs the root mean square error.\n\ngetRMSE = function(resp, pred, ...){\n  SE &lt;- (resp-pred)^2\n  MSE &lt;- mean(SE, ...)\n  RMSE &lt;- sqrt(MSE)\n  return(RMSE)\n}\n\nNow using a set seed, we create response values and predictions for testing.\n\nset.seed(10)\nn &lt;- 100\nx &lt;- runif(n)\nresp &lt;- 3 + 10 * x + rnorm(n)\npred &lt;- predict(lm(resp ~ x), data.frame(x))\n\n#test the function using resp a and pred vectors!\ngetRMSE(resp = resp, pred = pred)\n\n[1] 0.9581677\n\n\nNow setting two of the response values to NA’s, we can test out the ellipses to make sure that they can take the na.rm argument:\n\nresp[1] &lt;- NA_real_\nresp[2] &lt;- NA_real_\n\n#doesn't work!\ngetRMSE(resp = resp, pred = pred)\n\n[1] NA\n\n#works!\ngetRMSE(resp = resp, pred = pred, na.rm = TRUE)\n\n[1] 0.9661699\n\n\n\n\ngetMAE()\nNext, we are interested in creating a function for mean absolute error.\n\ngetMAE = function(resp, pred, ...){\n  AE &lt;- abs(resp-pred)\n  MAE &lt;- mean(AE, ...)\n  return(MAE)\n}\n\nGetting response values and predictions and testing allows us to make sure getMAE() follows the same specifications.\n\nn &lt;- 100\nx &lt;- runif(n)\nresp &lt;- 3 + 10 * x + rnorm(n)\npred &lt;- predict(lm(resp ~ x), data.frame(x))\n\ngetMAE(resp = resp, pred = pred)\n\n[1] 0.763681\n\nresp[1] &lt;- NA_real_\nresp[2] &lt;- NA_real_\n\n#doesn't work!\ngetMAE(resp = resp, pred = pred)\n\n[1] NA\n\n#works!\ngetMAE(resp = resp, pred = pred, na.rm = TRUE)\n\n[1] 0.7670436\n\n\n\n\nCreating a wrapper function, wrapperError()\nLet’s create a wrapper function that takes the prediction and response vectors, and allows the user to choose from different metrics. Note that if the vectors are not atomic, numeric, or not vectors, it will return error. Furthermore, if one of the required metrics is not specified, it will also return an error.\n\nwrapperError &lt;- function(pred, resp, metrics = c(\"RMSE\", \"MAE\"), ...){\n  errorResults &lt;- list()\n  if (!(is.vector(resp) && is.vector(pred) && is.atomic(resp) && is.atomic(pred) && is.numeric(resp) && is.numeric(pred)))\n  {\n    stop(\"Must pass a vector, must be numeric and/or must be atomic.\")\n  }\n  \n  if (!all(metrics %in% c(\"RMSE\", \"MAE\"))){\n    stop(\"Invalid or Incorrect Metrics Selected.\")\n  }\n  \n  if(\"RMSE\" %in% metrics){\n     errorResults$RMSE &lt;- getRMSE(pred, resp, ...)\n  }\n  if (\"MAE\" %in% metrics){\n    errorResults$MAE &lt;- getMAE(pred, resp, ...)\n  }\n  return(errorResults)\n}\n\nNow, let’s test this wrapper function. We set the same data to get the vectors. Let’s first make sure the metrics allows us to specify one and both(default).\n\n#test using this data\nset.seed(10)\nn &lt;- 100\nx &lt;- runif(n)\nresp &lt;- 3 + 10 * x + rnorm(n)\npred &lt;- predict(lm(resp ~ x), data.frame(x))\n\n#one at a time\nwrapperError(pred = pred, resp = resp, metrics = \"RMSE\")\n\n$RMSE\n[1] 0.9581677\n\nwrapperError(pred = pred, resp = resp, metrics = \"MAE\")\n\n$MAE\n[1] 0.8155776\n\n\n\n#both (default is both)\nwrapperError(pred = pred, resp = resp)\n\n$RMSE\n[1] 0.9581677\n\n$MAE\n[1] 0.8155776\n\nwrapperError(pred = pred, resp = resp, metrics = c(\"MAE\", \"RMSE\"))\n\n$RMSE\n[1] 0.9581677\n\n$MAE\n[1] 0.8155776\n\n\nMaking sure we can do the same thing with na.rm:\n\n#missing test\nresp[1] &lt;- NA_real_\nresp[2] &lt;- NA_real_\nwrapperError(pred = pred, resp = resp, na.rm = TRUE)\n\n$RMSE\n[1] 0.9661699\n\n$MAE\n[1] 0.8241201\n\n\nLet’s test the error for when passing something that is not a vector, atomic, or numeric:\n\n#incorrect data\npred = as.data.frame(pred)\nwrapperError(pred = pred, resp = resp)\n\nError in wrapperError(pred = pred, resp = resp): Must pass a vector, must be numeric and/or must be atomic.\n\n\nLet’s also test the error when specifying something that is not one of the two metrics listed above\n\n#trying it with incorrect metric\npred &lt;- predict(lm(resp ~ x), data.frame(x))\nwrapperError(pred = pred, resp = resp, metric = \"MSE\")\n\nError in wrapperError(pred = pred, resp = resp, metric = \"MSE\"): Invalid or Incorrect Metrics Selected."
  },
  {
    "objectID": "WritingFunctions.html#task-3-querying-an-api-and-a-tidy-style-function",
    "href": "WritingFunctions.html#task-3-querying-an-api-and-a-tidy-style-function",
    "title": "WritingFunctions",
    "section": "Task 3: Querying an Api and a Tidy-Style Function",
    "text": "Task 3: Querying an Api and a Tidy-Style Function\nIn particular, I am interested in seeing the recent hurricane news since I am from Tampa Bay, and hurricane Milton hit us pretty hard.\nLet’s load the appropriate libraries for this section:\n\nlibrary(httr)\nlibrary(jsonlite)\nlibrary(lubridate)\n\n\nUsing pluck() to Retrieve Information\nUsing GET(), fromJSON(), and pluck(), we can return various articles and the corresponding dataframe that has the article information. The first few rows are printed.\n\nid_info &lt;- GET(\"https://newsapi.org/v2/everything?q=hurricane&apiKey=7cb2cc16f78541a0bec77fe5e6ddc45a\")\n#str(id_info, max.level = 1)\n\nparsed &lt;- fromJSON(rawToChar(id_info$content))\narticles &lt;- pluck(parsed, \"articles\")\narticles_df &lt;- as.data.frame(articles)\nhead(articles_df)\n\n  source.id source.name        author\n1      &lt;NA&gt;   [Removed]          &lt;NA&gt;\n2     wired       Wired Matt Reynolds\n3     wired       Wired     Alec Luhn\n4     wired       Wired  Tommy Greene\n5      &lt;NA&gt; Gizmodo.com Isaac Schultz\n6      &lt;NA&gt; Gizmodo.com    Adam Kovac\n                                                                      title\n1                                                                 [Removed]\n2                            Why Tampa Is So Vulnerable to Hurricane Milton\n3 Hurricane Milton Shows How a Storm’s Category Doesn’t Tell the Full Story\n4  Hurricane Helene Will Send Shockwaves Through the Semiconductor Industry\n5          Satellite Images Reveal Hurricane Helene’s Devastating Aftermath\n6                    What to Expect When Hurricane Milton Rams Into Florida\n                                                                                                                                                                                                          description\n1                                                                                                                                                                                                           [Removed]\n2                                                          Tampa, Florida is the most vulnerable US city to hurricane damage. Delays to floodwater defenses and relentless development only made the situation worse.\n3 Milton’s reclassification to a Category 3 storm suggests it is weakening, but the scale accounts only for wind speed and not hurricane size, storm surge heights, or rainfall—which are all catastrophically large.\n4 Downpours at Spruce Pine, North Carolina have taken the biggest known deposit of high-purity quartz offline, leaving the global tech supply chain potentially starved of an ingredient vital for making microchips.\n5                                                                                                                    Images from space show vast swaths of the American southeast without power days after the storm.\n6                                                                        The monster storm will have winds reaching 150 miles (241 kilometers) per hour, and will dump an enormous amount of rain on coastal Florida.\n                                                                                                                                             url\n1                                                                                                                            https://removed.com\n2                                                                    https://www.wired.com/story/why-tampa-is-so-vulnerable-to-hurricane-milton/\n3                                                            https://www.wired.com/story/hurricane-milton-storm-category-doesnt-tell-full-story/\n4 https://www.wired.com/story/hurricane-helene-shockwaves-semiconductor-industry-microchips-spruce-pine-north-carolina-sand-high-quality-quartz/\n5                                                 https://gizmodo.com/satellite-images-reveal-hurricane-helenes-devastating-aftermath-2000507474\n6                                                          https://gizmodo.com/what-to-expect-when-hurricane-milton-rams-into-florida-2000509193\n                                                                                                                urlToImage\n1                                                                                                                     &lt;NA&gt;\n2         https://media.wired.com/photos/67057ef4d2d0817a9e1c0f3b/191:100/w_1280,c_limit/Science_TGH_storm_prep-4356-1.jpg\n3   https://media.wired.com/photos/67055d40b4b45ab73775f3d9/191:100/w_1280,c_limit/Science_Hurricane-Milton_APNewsroom.jpg\n4 https://media.wired.com/photos/66fb1e03c80e335f6471a5f5/191:100/w_1280,c_limit/science_hurricane_helene_silicon_tech.jpg\n5                                               https://gizmodo.com/app/uploads/2024/10/NOAA-20-satellite-helene-power.jpg\n6                                     https://gizmodo.com/app/uploads/2024/10/milton-satellite-image-hurricane-florida.jpg\n           publishedAt\n1 2024-10-04T12:00:10Z\n2 2024-10-09T18:36:34Z\n3 2024-10-09T23:32:18Z\n4 2024-10-01T11:48:00Z\n5 2024-10-04T16:20:39Z\n6 2024-10-08T17:35:52Z\n                                                                                                                                                                                                                   content\n1                                                                                                                                                                                                                [Removed]\n2   For more than a century, Tampa Bay has avoided Floridas most destructive hurricanes. Now Hurricane Milton may end that streak of luck, as the storm is expected to make landfall just south of Tampa Ba… [+2914 chars]\n3   Miltons enormous storm surge has also highlighted the growing danger from water. More intense hurricanes are pushing higher storm surges due to sea-level rise. These hurricanes on steroids, as Olson … [+3114 chars]\n4 A spokesperson for Sibelco said: As of September 26th, we have temporarily halted operations at the Spruce Pine facilities in response to these challenges.\\r\\nWe are working closely with our local team… [+3757 chars]\n5 Satellite images of the American southeast taken over the past few days are showcasing the disastrous impacts of Hurricane Helene at scale.\\r\\nThe images were taken by National Oceanic and Atmospheric … [+3345 chars]\n6   When Hurricane Milton makes landfall, it will bring devastating winds, torrential rains, and dangerous storm surges that government officials say pose a major threat to human life and property. Heres… [+5284 chars]\n\n\n\n\nQuery the API\nStarting off with a base URL, we can make a function that takes topic of interest, the time period, and an API Key so that the user can find relevant information with those parameters.\n\nbase_url &lt;- \"https://newsapi.org/v2/everything?\"\nquery_api = function(topic, time, apiKey) {\n  query_url &lt;- paste0(base_url, \"q=\", topic, \"&from=\",time,\"&apiKey=\",apiKey)\n  website_info &lt;- GET(query_url)\n  website_parsed &lt;- parsed &lt;- fromJSON(rawToChar(website_info$content))\n  website_articles &lt;- pluck(website_parsed, \"articles\")\n  website_df &lt;- as.data.frame(website_articles)\n  return((website_df))\n}\n\nNow let’s use our function to grab Hurricane information and Climate Change information at two specified dates. Save as two specified R objects.\n\nquery_hurricane &lt;- query_api(topic = \"hurricane\", time = \"2024-10-14\", apiKey = \"7cb2cc16f78541a0bec77fe5e6ddc45a\")\nquery_climate_change &lt;- query_api(topic = \"climate%20change\", time = \"2024-10-15\", apiKey = \"7cb2cc16f78541a0bec77fe5e6ddc45a\")\n\n\n\nSummarizing from the API Queries\nWe now have interest in taking our two queries saved as R objects and working through them. Here is a one-way contingency table for name of the hurricane set:\n\ntable(query_hurricane$source$name)\n\n\n                [Removed]                  ABC News                    Adweek \n                        4                         5                         1 \n       Al Jazeera English         Android Authority           Android Central \n                        2                         1                         2 \n                 BBC News         Biloxi Sun Herald                Biztoc.com \n                        1                         1                         2 \n          Bleacher Report            Boredpanda.com            Breitbart News \n                        1                         2                         2 \n         Business Insider                  CBS News           Cheezburger.com \n                        1                         9                         1 \n                     CNET               Cracked.com                  Deadline \n                        2                         1                         1 \n              Eonline.com                      ESPN                    Forbes \n                        1                         2                         5 \n               Gizmodo.jp Investor's Business Daily        Lakeplacidnews.com \n                        1                         1                         1 \n             Live Science         Naples Daily News                  NBC News \n                        1                         1                         1 \n            NBCSports.com            Newsherald.com                       NPR \n                        1                         1                         1 \n   Pensacola News Journal                  Phys.Org                 Pitchfork \n                        1                         2                         1 \n          Politicopro.com                   Poynter              Quartz India \n                        1                         3                         1 \n         Reporternews.com              Ritholtz.com   Sarasota Herald-Tribune \n                        1                         1                         1 \n      Scientific American               Screen Rant                     Skift \n                        1                         1                         2 \n             Slashdot.org            Slate Magazine                Snopes.com \n                        1                         1                         6 \n                Space.com           Tampa Bay Times                  TechSpot \n                        4                         1                         1 \n           The New Yorker           Theregister.com                     TODAY \n                        2                         1                         1 \n      Yahoo Entertainment \n                       10 \n\n\nNext, using the wonderful cheat sheet, we convert the publishedAt column into a date column. With this date column, we can find summary statistics of it and do more complex manipulations.\nThen, using some simple piping, we can go ahead and create a new variable that finds the differences in times between the article postings from most recent to second most recent.\n\nquery_hurricane$publishedAt &lt;- ymd_hms(query_hurricane$publishedAt)\nquery_climate_change$publishedAt &lt;- ymd_hms(query_climate_change$publishedAt)\nhead(query_hurricane$publishedAt)\n\n[1] \"2024-10-14 19:52:00 UTC\" \"2024-10-14 07:34:00 UTC\"\n[3] \"2024-10-15 17:06:43 UTC\" \"2024-10-14 09:08:45 UTC\"\n[5] \"2024-10-15 14:44:13 UTC\" \"2024-10-15 09:17:27 UTC\"\n\nhead(query_climate_change$publishedAt)\n\n[1] \"2024-10-15 13:00:00 UTC\" \"2024-10-15 18:00:00 UTC\"\n[3] \"2024-10-15 18:00:03 UTC\" \"2024-10-15 00:01:35 UTC\"\n[5] \"2024-10-15 07:15:37 UTC\" \"2024-10-15 14:41:37 UTC\"\n\nquery_hurricane &lt;- query_hurricane |&gt;\n  arrange(publishedAt) |&gt;\n  mutate(pub_diff = publishedAt - lag(publishedAt))\n\nquery_climate_change &lt;- query_climate_change |&gt;\n  arrange(publishedAt) |&gt;\n  mutate(pub_diff = publishedAt - lag(publishedAt))\n\nLet’s now subset the query for hurricane to only include the publishedAt and pub_diff columns. Then, using map() and an anonymous function, we can find the means and standard deviations for the two columns and return them as a list.\n\ndates_hurricane &lt;- query_hurricane |&gt;\n  select(publishedAt, pub_diff)\n\nmap(dates_hurricane, \\(x){\n  list(\n    mean = mean(x, na.rm = TRUE),\n    sd = sd(x, na.rm = TRUE),\n    median = median(x, na.rm = TRUE)\n  )\n})\n\n$publishedAt\n$publishedAt$mean\n[1] \"2024-10-15 00:03:49 UTC\"\n\n$publishedAt$sd\n[1] 49861.13\n\n$publishedAt$median\n[1] \"2024-10-14 19:42:22 UTC\"\n\n\n$pub_diff\n$pub_diff$mean\nTime difference of 1640.101 secs\n\n$pub_diff$sd\n[1] 2616.958\n\n$pub_diff$median\nTime difference of 947 secs"
  }
]